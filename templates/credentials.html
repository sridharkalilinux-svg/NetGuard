{% extends "base.html" %}

{% block content %}
<div class="mb-6">
    <h2 class="text-2xl font-bold text-white flex items-center gap-2">
        <i class="fas fa-key"></i> Compromised Credentials
    </h2>
    <div class="text-zinc-400 text-sm mt-1">Clear-text usernames and passwords found in traffic</div>
</div>

<div class="glass-panel rounded-3xl overflow-hidden border-white/10 mb-8">
    <div class="overflow-x-auto">
        <table class="w-full text-left border-collapse" id="creds-table">
            <thead>
                <tr class="bg-zinc-900/50 text-zinc-400 text-xs uppercase tracking-wider">
                    <th class="px-6 py-3 font-semibold">Protocol</th>
                    <th class="px-6 py-3 font-semibold">Source IP</th>
                    <th class="px-6 py-3 font-semibold">Destination IP</th>
                    <th class="px-6 py-3 font-semibold">Captured Data</th>
                    <th class="px-6 py-3 font-semibold">Risk</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-zinc-800 text-sm text-zinc-300">
                <!-- Populated by JS -->
            </tbody>
        </table>
    </div>
</div>

<div class="glass-panel p-6 rounded-3xl border-l-4 border-l-white">
    <h3 class="text-lg font-semibold text-white mb-2">Mitigation Strategy</h3>
    <p class="text-zinc-400 text-sm leading-relaxed">
        The above credentials were transmitted in clear-text. 
        Ensure <span class="text-white font-medium">TLS/SSL</span> is enabled for these services (HTTPS, SFTP, SSH) to prevent eavesdropping. 
        Disable legacy protocols like Telnet, FTP, and HTTP Basic Auth over non-secure channels immediately.
    </p>
</div>

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const id = '{{ id }}';
        fetch(`/api/data/${id}`)
            .then(res => res.json())
            .then(data => {
                const tbody = document.querySelector('#creds-table tbody');
                tbody.innerHTML = '';
                
                const creds = data.threats.filter(t => t.type === 'Clear-Text Credentials');
                
                if (creds.length > 0) {
                    creds.forEach(t => {
                        const row = document.createElement('tr');
                        row.className = "hover:bg-red-500/5 transition-colors";
                        row.innerHTML = `
                            <td class="px-6 py-4"><span class="px-2 py-1 rounded bg-red-500/20 text-red-400 text-xs font-bold border border-red-500/20">PLAINTEXT</span></td>
                            <td class="px-6 py-4 font-mono text-xs text-cyan-300">${t.src_ip}</td>
                            <td class="px-6 py-4 font-mono text-xs text-slate-300">${t.dst_ip}</td>
                            <td class="px-6 py-4 font-mono text-xs text-red-400 break-all bg-black/20 p-2 rounded">${t.detail}</td>
                            <td class="px-6 py-4 text-red-500 font-bold uppercase text-xs">Critical</td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-8 text-center text-slate-500">No compromised credentials found.</td></tr>';
                }
            });
    });
</script>
{% endblock %}
